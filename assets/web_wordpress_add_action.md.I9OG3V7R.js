import{_ as i,c as a,o as t,ae as n}from"./chunks/framework.B8KKhRA6.js";const E=JSON.parse('{"title":"add_action()函数详解","description":"","frontmatter":{"title":"add_action()函数详解","author":"刘军","location":"武汉","date":"2025-11-27T00:00:00.000Z"},"headers":[],"relativePath":"web/wordpress/add_action.md","filePath":"web/wordpress/add_action.md","lastUpdated":1764227611000}'),h={name:"web/wordpress/add_action.md"};function l(p,s,e,k,d,r){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="add-action-函数详解" tabindex="-1"><code>add_action()</code> 函数详解 <a class="header-anchor" href="#add-action-函数详解" aria-label="Permalink to &quot;\`add_action()\` 函数详解&quot;">​</a></h1><p>在WordPress开发中，<code>add_action()</code>是 <strong>动作钩子（Action Hooks）</strong> 的核心函数，用于将自定义函数（或方法）绑定到WordPress执行流程中的特定“动作点”。当WordPress触发该动作点（通过<code>do_action()</code>函数）时，绑定的自定义函数会自动执行，从而实现对WordPress默认流程的扩展或修改，无需修改核心代码。</p><h2 id="一、函数语法" tabindex="-1">一、函数语法 <a class="header-anchor" href="#一、函数语法" aria-label="Permalink to &quot;一、函数语法&quot;">​</a></h2><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $hook_name,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    callable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $callback,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $priority </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $accepted_args </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="二、参数详解" tabindex="-1">二、参数详解 <a class="header-anchor" href="#二、参数详解" aria-label="Permalink to &quot;二、参数详解&quot;">​</a></h2><ol><li><strong><code>$hook_name</code>（必填）</strong><br> 要绑定的<strong>动作钩子名称</strong>，可以是： <ul><li>WordPress内置动作钩子（如<code>init</code>、<code>wp_head</code>、<code>save_post</code>等）；</li><li>自定义动作钩子（通过<code>do_action(&#39;自定义钩子名&#39;)</code>手动触发）。</li><li><strong>常用内置动作钩子</strong></li></ul></li></ol><table tabindex="0"><thead><tr><th>钩子名称</th><th>触发时机</th></tr></thead><tbody><tr><td><code>init</code></td><td>WordPress初始化完成后</td></tr><tr><td><code>wp_head</code></td><td><code>&lt;head&gt;</code>标签内输出内容时</td></tr><tr><td><code>wp_footer</code></td><td>页面底部<code>&lt;/body&gt;</code>前输出时</td></tr><tr><td><code>save_post</code></td><td>文章/页面保存或更新时</td></tr><tr><td><code>admin_init</code></td><td>后台管理界面初始化时</td></tr><tr><td><code>after_setup_theme</code></td><td>主题加载完成后</td></tr><tr><td><code>admin_bar_menu</code></td><td>在管理工具栏渲染阶段注入、修改或移除菜单项目</td></tr></tbody></table><ol start="2"><li><p><strong><code>$callback</code>（必填）</strong><br> 动作触发时要执行的回调函数/方法，支持：</p><ul><li>普通函数名（字符串形式）；</li><li>类方法（如<code>array( &#39;类名&#39;, &#39;方法名&#39; )</code>或<code>array( $对象实例, &#39;方法名&#39; )</code>）；</li><li>匿名函数（PHP 5.3+）；</li><li>闭包或可调用对象。</li></ul></li><li><p><strong><code>$priority</code>（可选，默认10）</strong><br> 执行优先级：数字越小，回调函数越先执行；数字越大，越晚执行。</p><ul><li>多个函数绑定到同一个钩子时，优先级决定执行顺序；</li><li>相同优先级按绑定顺序执行。</li></ul></li><li><p><strong><code>$accepted_args</code>（可选，默认1）</strong><br> 回调函数能接收的<strong>参数数量</strong>，需与<code>do_action()</code>触发钩子时传递的参数数量匹配。</p></li></ol><h2 id="三、核心原理" tabindex="-1">三、核心原理 <a class="header-anchor" href="#三、核心原理" aria-label="Permalink to &quot;三、核心原理&quot;">​</a></h2><p>WordPress的动作钩子系统基于“发布-订阅”模式：</p><ul><li><code>do_action(&#39;钩子名&#39;, 参数1, 参数2...)</code>：发布（触发）动作；</li><li><code>add_action(&#39;钩子名&#39;, 回调函数)</code>：订阅动作，等待触发时执行回调。</li></ul><h2 id="四、使用示例" tabindex="-1">四、使用示例 <a class="header-anchor" href="#四、使用示例" aria-label="Permalink to &quot;四、使用示例&quot;">​</a></h2><h3 id="_1-基础示例-在页面头部添加自定义代码" tabindex="-1">1. 基础示例：在页面头部添加自定义代码 <a class="header-anchor" href="#_1-基础示例-在页面头部添加自定义代码" aria-label="Permalink to &quot;1. 基础示例：在页面头部添加自定义代码&quot;">​</a></h3><p>绑定到<code>wp_head</code>钩子（WordPress渲染<code>&lt;head&gt;</code>标签时触发）：</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 定义自定义函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_custom_wp_head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&lt;meta name=&quot;author&quot; content=&quot;豆包编程助手&quot;&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 绑定到wp_head钩子，优先级10，接收1个参数（默认）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;wp_head&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my_custom_wp_head&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> );</span></span></code></pre></div><h3 id="_2-带参数的示例-监听文章保存动作" tabindex="-1">2. 带参数的示例：监听文章保存动作 <a class="header-anchor" href="#_2-带参数的示例-监听文章保存动作" aria-label="Permalink to &quot;2. 带参数的示例：监听文章保存动作&quot;">​</a></h3><p><code>save_post</code>钩子会传递3个参数：<code>$post_id</code>（文章ID）、<code>$post</code>（文章对象）、<code>$update</code>（是否为更新）：</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_save_post_handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $post_id, $post, $update ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 仅处理文章类型为post的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;post&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $post</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">post_type ) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        update_post_meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $post_id, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;saved_time&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">current_time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;timestamp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 优先级20，接收3个参数（需与do_action传递的参数数一致）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;save_post&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my_save_post_handler&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> );</span></span></code></pre></div><h3 id="_3-类方法示例-面向对象方式绑定" tabindex="-1">3. 类方法示例：面向对象方式绑定 <a class="header-anchor" href="#_3-类方法示例-面向对象方式绑定" aria-label="Permalink to &quot;3. 类方法示例：面向对象方式绑定&quot;">​</a></h3><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> My_Action_Class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __construct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 绑定类内方法到init钩子</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        add_action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;init&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;init_handler&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> init_handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 初始化自定义文章类型等操作</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        register_post_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;book&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;labels&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;图书&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;public&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 实例化类，触发绑定</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> My_Action_Class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="_4-自定义钩子示例-手动触发动作" tabindex="-1">4. 自定义钩子示例：手动触发动作 <a class="header-anchor" href="#_4-自定义钩子示例-手动触发动作" aria-label="Permalink to &quot;4. 自定义钩子示例：手动触发动作&quot;">​</a></h3><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自定义钩子：my_custom_hook</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">do_action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my_custom_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;参数1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;参数2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 绑定自定义钩子的回调</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my_custom_hook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( $arg1, $arg2 ) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;自定义钩子触发，参数：</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$arg1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$arg2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> );</span></span></code></pre></div><h2 id="五、注意事项" tabindex="-1">五、注意事项 <a class="header-anchor" href="#五、注意事项" aria-label="Permalink to &quot;五、注意事项&quot;">​</a></h2><ol><li><strong>优先级冲突</strong>：若多个函数绑定到同一钩子，注意优先级设置，避免逻辑覆盖。</li><li><strong>参数数量匹配</strong>：<code>accepted_args</code>需与<code>do_action()</code>传递的参数数一致，否则回调函数无法接收全部参数。</li><li><strong>移除动作</strong>：可通过<code>remove_action()</code>移除已绑定的动作，参数需与<code>add_action()</code>完全一致（包括优先级和参数数）：<div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove_action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;wp_head&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my_custom_wp_head&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> );</span></span></code></pre></div></li><li><strong>与过滤器的区别</strong>：动作钩子（<code>add_action</code>）仅执行操作，无返回值；过滤器（<code>add_filter</code>）需返回修改后的值（如修改文章内容）。</li></ol>`,24)]))}const c=i(h,[["render",l]]);export{E as __pageData,c as default};
